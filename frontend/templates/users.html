<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usuários - Sistema de Gestão de Sugestões</title>
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-logo">
                <h1>
                    <!-- Logo Biopark SVG -->
                    <svg viewBox="0 0 200 60" fill="currentColor">
                        <g>
                            <path d="M16 8c0-4.4 3.6-8 8-8s8 3.6 8 8v16c0 4.4-3.6 8-8 8s-8-3.6-8-8V8z" fill="#e53e3e"/>
                            <path d="M40 16c0-4.4 3.6-8 8-8s8 3.6 8 8v20c0 6.6-5.4 12-12 12s-12-5.4-12-12V16z" fill="#ffffff"/>
                            <text x="70" y="35" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="currentColor">Biopark</text>
                        </g>
                    </svg>
                </h1>
            </div>
            <div class="sidebar-nav">
                <ul>
                    <li>
                        <a href="/dashboard">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                            </svg>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="/suggestions">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"/>
                            </svg>
                            Sugestões
                        </a>
                    </li>
                    <li>
                        <a href="/users" class="active">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                            </svg>
                            Usuários
                        </a>
                    </li>
                    <li>
                        <a href="/reports">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                            </svg>
                            Relatórios
                        </a>
                    </li>
                    <li>
                        <a href="/sync">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                            </svg>
                            Sincronização
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">Usuários</h1>
                    <p class="page-subtitle">Gerencie os usuários do sistema</p>
                </div>
                <button class="btn btn-primary" onclick="openNewUserModal()">
                    <svg fill="currentColor" viewBox="0 0 20 20" width="16" height="16">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"/>
                    </svg>
                    Novo Usuário
                </button>
            </div>

            <!-- User Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <svg fill="currentColor" viewBox="0 0 20 20" width="24" height="24">
                            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-users">0</h3>
                        <p>Total de Usuários</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon green">
                        <svg fill="currentColor" viewBox="0 0 20 20" width="24" height="24">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="active-users">0</h3>
                        <p>Usuários Ativos</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon yellow">
                        <svg fill="currentColor" viewBox="0 0 20 20" width="24" height="24">
                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="admin-users">0</h3>
                        <p>Administradores</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon red">
                        <svg fill="currentColor" viewBox="0 0 20 20" width="24" height="24">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="inactive-users">0</h3>
                        <p>Usuários Inativos</p>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-select" id="status-filter" onchange="applyFilters()">
                        <option value="">Todos</option>
                        <option value="active">Ativo</option>
                        <option value="inactive">Inativo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Função</label>
                    <select class="form-select" id="role-filter" onchange="applyFilters()">
                        <option value="">Todas</option>
                        <option value="admin">Administrador</option>
                        <option value="user">Usuário</option>
                        <option value="moderator">Moderador</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Buscar</label>
                    <input type="text" class="form-input" id="search-input" placeholder="Buscar por nome ou email..." onkeyup="applyFilters()">
                </div>
            </div>

            <!-- Users Table -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">Lista de Usuários</h2>
                        <p class="card-subtitle" id="users-count">0 usuários encontrados</p>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Função</th>
                                <th>Status</th>
                                <th>Último Acesso</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="users-table">
                            <!-- Dados carregados via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- New User Modal -->
    <div class="modal" id="new-user-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Novo Usuário</h3>
                <button class="modal-close" onclick="closeNewUserModal()">&times;</button>
            </div>
            <form id="new-user-form" onsubmit="submitNewUser(event)">
                <div class="form-group">
                    <label class="form-label">Nome</label>
                    <input type="text" class="form-input" name="name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" name="email" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Função</label>
                    <select class="form-select" name="role" required>
                        <option value="">Selecione uma função</option>
                        <option value="user">Usuário</option>
                        <option value="moderator">Moderador</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Senha Temporária</label>
                    <input type="password" class="form-input" name="password" required>
                </div>
                <div class="d-flex justify-content-between gap-2">
                    <button type="button" class="btn btn-secondary" onclick="closeNewUserModal()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Criar Usuário
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // API Integration
        const API_BASE = '/api';
        let allUsers = [];
        
        // Load users
        async function loadUsers() {
            try {
                const response = await fetch(`${API_BASE}/users`);
                if (response.ok) {
                    const data = await response.json();
                    allUsers = data.items || data;
                } else {
                    // Fallback mock data
                    allUsers = [
                        {
                            id: 1,
                            name: 'João Silva',
                            email: 'joao.silva@biopark.com.br',
                            role: 'admin',
                            status: 'active',
                            last_login: '2024-01-15T10:30:00Z',
                            created_at: '2024-01-01T00:00:00Z'
                        },
                        {
                            id: 2,
                            name: 'Maria Santos',
                            email: 'maria.santos@biopark.com.br',
                            role: 'moderator',
                            status: 'active',
                            last_login: '2024-01-14T15:20:00Z',
                            created_at: '2024-01-02T00:00:00Z'
                        },
                        {
                            id: 3,
                            name: 'Pedro Costa',
                            email: 'pedro.costa@biopark.com.br',
                            role: 'user',
                            status: 'active',
                            last_login: '2024-01-13T09:15:00Z',
                            created_at: '2024-01-03T00:00:00Z'
                        },
                        {
                            id: 4,
                            name: 'Ana Oliveira',
                            email: 'ana.oliveira@biopark.com.br',
                            role: 'user',
                            status: 'inactive',
                            last_login: '2024-01-10T14:45:00Z',
                            created_at: '2024-01-04T00:00:00Z'
                        },
                        {
                            id: 5,
                            name: 'Carlos Ferreira',
                            email: 'carlos.ferreira@biopark.com.br',
                            role: 'user',
                            status: 'active',
                            last_login: '2024-01-12T11:30:00Z',
                            created_at: '2024-01-05T00:00:00Z'
                        }
                    ];
                }
                updateStats();
                renderUsers(allUsers);
            } catch (error) {
                console.error('Erro ao carregar usuários:', error);
                // Mock data fallback
                allUsers = [
                    {
                        id: 1,
                        name: 'João Silva',
                        email: 'joao.silva@biopark.com.br',
                        role: 'admin',
                        status: 'active',
                        last_login: '2024-01-15T10:30:00Z',
                        created_at: '2024-01-01T00:00:00Z'
                    },
                    {
                        id: 2,
                        name: 'Maria Santos',
                        email: 'maria.santos@biopark.com.br',
                        role: 'moderator',
                        status: 'active',
                        last_login: '2024-01-14T15:20:00Z',
                        created_at: '2024-01-02T00:00:00Z'
                    },
                    {
                        id: 3,
                        name: 'Pedro Costa',
                        email: 'pedro.costa@biopark.com.br',
                        role: 'user',
                        status: 'active',
                        last_login: '2024-01-13T09:15:00Z',
                        created_at: '2024-01-03T00:00:00Z'
                    },
                    {
                        id: 4,
                        name: 'Ana Oliveira',
                        email: 'ana.oliveira@biopark.com.br',
                        role: 'user',
                        status: 'inactive',
                        last_login: '2024-01-10T14:45:00Z',
                        created_at: '2024-01-04T00:00:00Z'
                    },
                    {
                        id: 5,
                        name: 'Carlos Ferreira',
                        email: 'carlos.ferreira@biopark.com.br',
                        role: 'user',
                        status: 'active',
                        last_login: '2024-01-12T11:30:00Z',
                        created_at: '2024-01-05T00:00:00Z'
                    }
                ];
                updateStats();
                renderUsers(allUsers);
            }
        }
        
        function updateStats() {
            const totalUsers = allUsers.length;
            const activeUsers = allUsers.filter(user => user.status === 'active').length;
            const adminUsers = allUsers.filter(user => user.role === 'admin').length;
            const inactiveUsers = allUsers.filter(user => user.status === 'inactive').length;
            
            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('active-users').textContent = activeUsers;
            document.getElementById('admin-users').textContent = adminUsers;
            document.getElementById('inactive-users').textContent = inactiveUsers;
        }
        
        function renderUsers(users) {
            const tbody = document.getElementById('users-table');
            const count = document.getElementById('users-count');
            
            count.textContent = `${users.length} usuários encontrados`;
            
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>#${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>
                        <span class="badge ${getRoleBadgeClass(user.role)}">
                            ${getRoleText(user.role)}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${getStatusBadgeClass(user.status)}">
                            ${getStatusText(user.status)}
                        </span>
                    </td>
                    <td>${formatDate(user.last_login)}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="editUser(${user.id})">
                            Editar
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        function applyFilters() {
            const statusFilter = document.getElementById('status-filter').value;
            const roleFilter = document.getElementById('role-filter').value;
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            
            let filteredUsers = allUsers.filter(user => {
                const matchesStatus = !statusFilter || user.status === statusFilter;
                const matchesRole = !roleFilter || user.role === roleFilter;
                const matchesSearch = !searchInput || 
                    user.name.toLowerCase().includes(searchInput) ||
                    user.email.toLowerCase().includes(searchInput);
                
                return matchesStatus && matchesRole && matchesSearch;
            });
            
            renderUsers(filteredUsers);
        }
        
        function getRoleBadgeClass(role) {
            const roleMap = {
                'admin': 'badge-danger',
                'moderator': 'badge-warning',
                'user': 'badge-info'
            };
            return roleMap[role] || 'badge-info';
        }
        
        function getRoleText(role) {
            const roleMap = {
                'admin': 'Administrador',
                'moderator': 'Moderador',
                'user': 'Usuário'
            };
            return roleMap[role] || role;
        }
        
        function getStatusBadgeClass(status) {
            const statusMap = {
                'active': 'badge-success',
                'inactive': 'badge-danger'
            };
            return statusMap[status] || 'badge-info';
        }
        
        function getStatusText(status) {
            const statusMap = {
                'active': 'Ativo',
                'inactive': 'Inativo'
            };
            return statusMap[status] || status;
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }
        
        // Modal functions
        function openNewUserModal() {
            document.getElementById('new-user-modal').classList.add('active');
        }
        
        function closeNewUserModal() {
            document.getElementById('new-user-modal').classList.remove('active');
            document.getElementById('new-user-form').reset();
        }
        
        async function submitNewUser(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const userData = {
                name: formData.get('name'),
                email: formData.get('email'),
                role: formData.get('role'),
                password: formData.get('password')
            };
            
            try {
                const response = await fetch(`${API_BASE}/users`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                
                if (response.ok) {
                    alert('Usuário criado com sucesso!');
                    closeNewUserModal();
                    loadUsers();
                } else {
                    alert('Erro ao criar usuário. Tente novamente.');
                }
            } catch (error) {
                console.error('Erro ao criar usuário:', error);
                alert('Erro ao criar usuário. Tente novamente.');
            }
        }
        
        function editUser(id) {
            alert(`Editar usuário #${id}`);
        }
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadUsers);
        
        // Close modal when clicking outside
        document.getElementById('new-user-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeNewUserModal();
            }
        });
    </script>
</body>
</html>
